<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.chenhan.serialAgent.infrastructure.dao.IGlobalSidDao">

    <!--结果映射map-->
    <resultMap id="globalSidMap" type="org.chenhan.serialAgent.infrastructure.po.GlobalSid" >
        <id column="id" property="id"/>
        <result column="caller" property="caller"/>
        <result column="flow_id" property="flowId"/>
        <result column="status" property="status"/>
        <result column="result_code" property="resultCode"/>
        <result column="ip" property="ip"/>
        <result column="tx_code" property="txCode"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>


    <!-- 插入全局流水号记录 -->
    <insert id="insert" parameterType="org.chenhan.serialAgent.infrastructure.po.GlobalSid"  useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `global_sid` (caller, flow_id, status,  ip, tx_code, create_time, update_time)
        VALUES (#{caller}, #{flowId}, #{status},  #{ip}, #{txCode}, #{createTime}, #{updateTime})
    </insert>

    <!-- 更新全局流水号的状态 -->
    <update id="updateState" parameterType="org.chenhan.serialAgent.infrastructure.po.GlobalSid">
        UPDATE global_sid
        SET status = #{status},
            result_code = #{resultCode}
        WHERE id = #{id}
    </update>
</mapper>
